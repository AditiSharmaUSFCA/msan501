# Image Processing

The goal of this project is to exercise your understanding of all of the major components in Python: assignments, expressions, if and loop statements, functions, lists, and libraries. To make things interesting, we will perform some cool image processing tasks:

* flipping horizontally
* blurring
* removing salt-and-pepper image noise
* finding edges within images
* image sharpening

For example, here is a sharpened image before/after:

![](figures/bonkers.png) ![](figures/bonkers-sharp-zoom.png)

## Starter kit and expected output

I have provided a Jupyter Lab notebook for you to use as a [starter kit](https://github.com/parrt/msan501/blob/master/projects/images-starterkit.ipynb). You should save that file into the directory associated with your repository and then make edits to it. That is the file you will submit for grading.

You can find all of the [expected images](https://github.com/parrt/msan501/blob/master/projects/images-expected-output.zip?raw=true) generated by this project in the repository.

## Git from the command line

Let's prepare our programming environment so that submitting this project is easy.  This process is abbreviated here, but you can see it fleshed out in more detail in the section "Getting Started On The Images Project" of the [git lecture](https://github.com/parrt/msan501/blob/master/notes/git.md).

I will post to slack or via the students email list a URL for each project that represents an invitation to create a repository associated with a specific project for this class. Each student will have their own private repository per project. Once you have created the repository, you can proceed with this section to clone that empty repository onto your laptop disk.

Launch Terminal.app or whatever your bash shell is called on your system. Now, using a browser, go to the URL associated with your images project at github, which should be something like (*YOURID* is your github user name not your laptop username or your USF username): 

https://github.com/YOURID/images-YOURID

and copy the **HTTPS not SSH** URL from here:

<img src="../notes/images/github-setup.png" width="400">

Then, use the `git clone `command as you see below, replacing `images-parrt` with images-*yourid*. You will have to type in your github user ID and password.

```bash
$ cd ~/msan501 #  assuming this is where you want the root of all of 501 projects
 git clone https://github.com/USF-MSAN501/images-parrt.git
Cloning into 'images-parrt'...
Username for 'https://github.com': parrt
Password for 'https://parrt@github.com': 
warning: You appear to have cloned an empty repository.
$ cd images-parrt # after this command you are now in your repository
```

There is nothing in the repo yet, but we'll get to it!

## Getting started

The first thing we have to do is get the starter kit into the directory associated with your repository. The repository only knows about files that live underneath the images-*yourid* directory. Save the [starter kit](https://github.com/parrt/msan501/blob/master/projects/images-starterkit.ipynb) as file **images.ipynb** to your equivalent of `~/msan501/images-parrt` directory. (In other words, rename the starter kit to be **images.ipynb**.)

Once you have saved that file, you need to add it to the repository. Remember that the repository does not track any file you don't tell it to track:

```bash
$ git add images.ipynb
$ git commit -a -m 'Initial add of starter kit'
...
```

That has commit your change (and addition of a file) to the local repository and now you need to push it back to github, the remote repository:

```bash
$ git push origin master
...
```

Go check out that github has the file. The web page for your repository should look something like the following, but without the images:

<img src="figures/github-initial-add.png" width="400">

Next, fire up Jupyter Lab *in the directory holding your images.ipynb file*:

```bash
$ cd ~/msan501/images-parrt
$ jupyter lab
...
```

This will launch a new tab in your browser.  From the file pane on the left, select the file `images.ipynb` and it will show you the skeleton that you need to fill-in as part of the project.

I have provided a number of [images](https://github.com/parrt/msan501/tree/master/projects/figures) that you can use to play around with this project. Of course, you can use any others you want. (Remember, however, that all images used in this class and those stored on University equipment must be "safe for work." Keep it G-rated please, with no offensive images popping up on your laptops or machines during lab etc.)

## Task 1. Flipping an image horizontally

As a first task,  create a script called `flip.py` that shows the image provided as a program (command-line) argument in its original form and then flipped horizontally.  For example, here are the before and after shots for flipping image `eye.png`:

<img src="figures/eye.png" width="150"> <img src="figures/eye-flip.png" width="150">

The first thing you need to learn is how to display an image, in this case inside of Jupiter notebooks. (If you do `img.show()`, than a separate window will pop up instead of showing it in line in the notebook.)

```python
from PIL import Image

img = Image.open('eye.png')
img = img.convert("L") # grayscale
img
```

That loads the `eye.png` file from the directory holding the `images.ipynb` file. 


### Three new Pillow pieces}

To write your `flip` function, you will need three basic pieces:

<ul>
<li> `img.size` returns a tuple containing the width and height of image `img` so you can write code like this:
```python
width, height = img.size
```
You'll need the width and height to iterate over the pixels of the image.

<li> `img.copy()` duplicates image `img`.  For our `flip` function, it would be hard to modify the image in place because we would be overwriting pixels we would need to flip later. It's easier to create a copy of the image in flipped position. You can write code like this:\\
`imgdup = img.copy()`

<li> `img.load()` is yet another weird name from PIL that actually returns an object that looks like a two-dimensional matrix, which is really just a lists of lists such as `m = [[1,2], [3, 4]]`. When printed, the output looks like a matrix:

```python
m = [[1, 2],
     [3, 4]]
```
To get element `3`, we would use list index expression `m[1][0]` because we want the list at index 1, `m[1]`, and then element 0 within that list. The two-dimensional object returned by `load()` uses similar notation. If we ask for the ``matrix'' with:
```python
m = img.load()
```
then we  use notation `m[x,y]` to get the pixel at position (`x`, `y`).
</ul>

You will use these functions for the remaining tasks so keep them in mind.

### Iterating over the image matrix}

{\bf Define function} `flip` using the familiar function definition syntax and have it take a parameter called `img`, which will be the image we want to flip. The goal is to create a copy of this image, flip it, and return a copy so that we do not alter the incoming original image. To create `flip`, write code that implements the following steps.

<ol>
<li> Use `size` to define local variables `width` and `height`
<li> Use `copy()` to make a copy of the incoming image `img` and save it in a local variable
<li> Use `load()` to get the two-dimensional pixel matrix out of the incoming image and the copy of the image. Store these results in two new local variables.
<li> To walk over the two-dimensional image, we've learned we need every combination of `x` and `y`. That means we need a nested `for` loop. Create a nested for loop that iterates over all `x` and all `y` values within the `width` and `height` of the image.
<li> Within the inner loop, set pixels in the image copy to the appropriate pixel copied from the original image
<li> At the end of the function, return the flipped image
</ol>

The only remaining issue is determining which pixel from the original image to copy into the (`x`, `y`) position in the image copy. The `y` index will be the same since we are flipping horizontally. The `x` index in the flipped image is index `width-x-1` from the original image. Trying out a few sample indexes shows that this works well. For example, a flipped image with `width=10` has its pixel at `x=0` pulled from index `x=10-0-1=9` in the original image. That's great, because it takes the image from all in the right in the original and copies it to the far left of the copy. Checking the opposite extreme, `x=9` in the flipped image should be `x=10-9-1=0` from the original image.

### What to do when the program doesn't work

If you have problems, follow these steps:

<ol>
<li> Don't Panic! Relax and realize that you will solve this problem, even if it takes a little bit of messing around. Banging your head against the computer is part of your job. Remember that the computer is doing precisely what you tell it to do. There is no mystery.

<li>  Determine precisely what is going on. Did you get an error message from Python?  Is it a syntax error? If so, review the syntax of all your statements and expressions. PyCharm is your friend here and should highlight erroneous things with a red squiggly underline. If you got an error message that has what we call a stack trace, a number of things could be wrong. For example, if I misspell `show()` as `shower()`, I get the following message:

```
Traceback (most recent call last):
  File "/Users/parrt/msan501/images-parrt/flip.py", line 26, in <module>
    img.shower()
  File "/usr/local/lib/python2.7/site-packages/PIL/Image.py", line 605, in __getattr__
    raise AttributeError(name)
AttributeError: shower
```

<li> If it does not look like it some simple misspelling, you might get lucky and find something in Google if you cut-and-paste that error message.
<li> If your script shows the original image but not the flipped image, then you likely have a problem with your `flip` function.
<li> If your program is at least running and doing something, then insert print statements to figure out what the variables are and how far into the program you get before a craps out. That often tells you what the problem is.
<li>  Definitely try to solve the problem yourself, but don't waste too much time. I can typically help you out quickly so you can move forward.
</ol>

**Deliverables**. Make sure that your `images.ipynb` file is correctly committed to your repository and pushed to github. Verify this by going to github website. Make sure that it is in the main directory and not a subdirectory of your repository!!!
